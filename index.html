<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigation Portfolio</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400&family=Special+Elite&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles -->
    <style>
        .font-typewriter { font-family: 'Courier Prime', monospace; }
        .font-heading { font-family: 'Special Elite', cursive; }
        .font-handwriting { font-family: 'Caveat', cursive; }

        body {
            min-height: 100vh;
            overflow-x: hidden;
        }

        .mode-main {
            background-color: #1a0f0f;
            color: #d4c5a3;
        }

        .mode-storyboard {
            background: linear-gradient(135deg, #3a3a3a 0%, #2a2a2a 100%);
            color: #d4c5a3;
        }

        /* Grain Texture */
        .bg-grain {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* Animations */
        .animate-flicker {
            animation: flicker 4s infinite;
        }

        @keyframes flicker {
            0%, 19.999%, 22%, 62.999%, 64%, 64.999%, 70%, 100% { opacity: 0.95; }
            20%, 21.999%, 63%, 63.999%, 65%, 69.999% { opacity: 0.8; }
        }

        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .animate-fade-in {
            animation: fadeIn 1s ease-out forwards;
        }
        
        .animate-fade-out {
            animation: fadeOut 0.4s ease-in forwards;
        }
        
        .animate-slide-up {
            animation: slideUp 0.7s ease-out forwards;
        }

        @keyframes fadeOut { 
            from { opacity: 1; } 
            to { opacity: 0; } 
        }
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }
        @keyframes slideUp { 
            from { transform: translateY(1rem); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }

        .paper-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        /* Scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .perspective-1000 { perspective: 1000px; }

        /* Blur Utility */
        .blur-text {
            filter: blur(3px);
            user-select: none;
            opacity: 0.5;
        }

        /* Question modal styling (from question.html) */
        .security-modal {
            background: rgba(44, 26, 26, 0.95);
            border: 3px solid #d4a574;
            border-radius: 8px;
            padding: 60px 50px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            position: relative;
        }
        .modal-title {
            font-family: 'Courier Prime', monospace;
            font-size: 32px;
            letter-spacing: 4px;
            color: #d4a574;
            text-align: center;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .modal-divider { height: 2px; background: #d4a574; margin: 20px 0 40px 0; }
        .modal-question { font-family: 'Courier Prime', monospace; color: #d4c5a3; font-size: 18px; text-align: center; margin-bottom: 40px; line-height: 1.6; }
        .option-button {
            width: 100%;
            padding: 18px 20px;
            margin-bottom: 20px;
            border: 2px solid #5c3a3a;
            background: #1a0f0f;
            color: #d4a574;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border-radius: 4px;
        }
        .option-button:hover { background: #3d2424; border-color: #d4a574; transform: translateX(5px); }
        .option-button:active { background: #d4a574; color: #1a0f0f; transform: translateX(3px); }
        .option-letter {
            display: flex; align-items: center; justify-content: center;
            width: 35px; height: 35px; border: 2px solid #d4a574; border-radius: 50%; font-weight: bold; flex-shrink: 0;
        }
        .option-button:hover .option-letter { background: #d4a574; color: #1a0f0f; }
        .feedback-message { font-family: 'Courier Prime', monospace; margin-top: 20px; padding: 15px; border-radius: 4px; text-align: center; font-weight: bold; display: none; }
        .feedback-correct { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 2px solid #10b981; }
        .feedback-incorrect { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 2px solid #ef4444; }

        /* Storyboard styles */
        .storyboard-container { height: 100vh; display: flex; flex-direction: column; justify-content: space-between; padding: 20px; max-width: 100%; box-sizing: border-box; }
        .story-content { display: flex; gap: 20px; flex: 1; margin-top: 0; width: 100%; height: 100%; box-sizing: border-box; }
        .left-box { flex: 0 0 30%; background: #e8dcc8; border: 4px solid #4a3428; border-radius: 8px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); overflow: hidden; display: flex; align-items: stretch; justify-content: center; }
        .video-fill { width: 100%; height: 100%; object-fit: cover; object-position: 50% 20%; background: #f1e7d3; }
        .right-box { flex: 0 0 70%; display: flex; flex-direction: column; gap: 12px; }
        .story-panel { flex: 1 1 auto; background: #e8dcc8; border: 4px solid #4a3428; border-radius: 8px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); padding: 20px; display: flex; flex-direction: column; gap: 10px; overflow: hidden; }
        .story-panel .story-body { flex: 1; overflow-y: auto; }
        .story-box::-webkit-scrollbar { width: 8px; }
        .story-box::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
        .story-box::-webkit-scrollbar-thumb { background: #8b6f47; border-radius: 4px; }
        .story-title { font-size: 18px; font-weight: bold; color: #2c1a1a; text-align: center; border-bottom: 2px solid #4a3428; padding-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .story-subtitle { font-family: 'Courier Prime', monospace; font-size: 12px; color: #4a3428; text-align: center; letter-spacing: 2px; margin-top: 6px; text-transform: uppercase; }
        .story-text { font-family: 'Courier Prime', monospace; color: #3c2c1c; font-size: 17px; line-height: 1.7; text-align: left; }
        .story-text strong { color: #2c1a1a; font-weight: bold; }
        .question-box { background: #e8dcc8; border: 4px solid #4a3428; border-radius: 8px; padding: 20px; width: 100%; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); flex: 1 1 auto; display: flex; flex-direction: column; }
        .question-title { font-family: 'Courier Prime', monospace; font-size: 18px; font-weight: bold; color: #2c1a1a; text-align: center; border-bottom: 2px solid #4a3428; padding-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .question-divider { height: 2px; background: #4a3428; margin: 8px 0 15px 0; }
        .question-text { font-family: 'Courier Prime', monospace; color: #3c2c1c; font-size: 15px; text-align: center; margin-bottom: 15px; line-height: 1.5; }
        .options-container { display: flex; flex-direction: row; gap: 15px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
        .option-btn { flex: 1; min-width: 150px; padding: 12px 16px; border: 2px solid #4a3428; background: #d4c5a3; color: #2c1a1a; font-family: 'Courier Prime', monospace; font-size: 14px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; border-radius: 4px; }
        .option-btn:hover { background: #c4b555; border-color: #8b6f47; transform: scale(1.05); }
        .option-btn:active { background: #d4a574; color: #1a0f0f; transform: scale(0.95); }
        .option-btn .option-letter { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border: 2px solid #4a3428; border-radius: 50%; font-weight: bold; flex-shrink: 0; color: #2c1a1a; }
        .option-btn:hover .option-letter { background: #d4a574; color: #1a0f0f; }
        .feedback-correct { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 2px solid #10b981; }
        .feedback-incorrect { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 2px solid #ef4444; }
    </style>
</head>
<body class="mode-main text-[#d4c5a3] font-sans relative selection:bg-emerald-900 selection:text-white">

    <!-- MAIN VIEW -->
    <div id="main-view">
        <!-- Global Texture Overlays -->
        <div class="fixed inset-0 pointer-events-none bg-grain z-50"></div>
        <div class="fixed inset-0 pointer-events-none z-40 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.8)_100%)]"></div>

        <!-- Header UI -->
        <header class="fixed top-0 left-0 right-0 z-30 p-4 flex justify-between items-start pointer-events-auto bg-gradient-to-b from-[#1a0f0f] to-transparent md:bg-none">
            <div class="relative flex gap-4">
                <button onclick="toggleHelp()" class="p-2 bg-[#2c1a1a] border border-[#d4c5a3] hover:bg-[#3d2424] transition-colors rounded-sm shadow-lg">
                    <i data-lucide="help-circle" class="w-5 h-5"></i>
                </button>
                <div id="help-tooltip" class="hidden absolute top-16 left-4 bg-stone-900 border border-[#d4c5a3] p-4 w-64 text-xs font-typewriter z-50 shadow-xl animate-fade-in">
                    <p class="mb-2 text-emerald-400"><strong>MISSION:</strong> Unlock Swetha's investment history.</p>
                    <p>Solve the riddle in each file to reveal the underlying asset value.</p>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button onclick="skipCase()" class="flex items-center gap-2 text-xs font-typewriter hover:text-emerald-400 transition-colors uppercase tracking-widest bg-[#1a0f0f]/50 p-2 rounded backdrop-blur-sm">
                    <i data-lucide="fast-forward" class="w-4 h-4"></i> <span class="hidden md:inline">Skip Investigation</span>
                </button>
                <button class="opacity-50 hover:opacity-100 transition-opacity p-2">
                    <i data-lucide="settings" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="app-container" class="relative min-h-screen pt-24 pb-24 px-4 md:px-0 md:pl-20 md:pr-32 max-w-6xl mx-auto flex flex-col items-center">
            <!-- Content injected via JS -->
        </main>

        <!-- Inventory Sidebar (Right) -->
        <aside class="fixed bottom-0 left-0 right-0 md:top-0 md:left-auto md:right-0 md:h-full md:w-24 bg-[#0d0707] border-t md:border-t-0 md:border-l border-[#3d2424] z-20 flex md:flex-col items-center justify-start md:pt-24 gap-4 p-4 overflow-x-auto md:overflow-visible no-scrollbar">
            <div class="hidden md:block absolute top-6 font-typewriter text-[10px] text-center w-full opacity-50 tracking-widest uppercase">
                Evidence<br/>Locker
            </div>
            <div id="inventory-list" class="flex md:flex-col gap-4">
                <!-- Inventory items injected via JS -->
            </div>
        </aside>

        <!-- Modal: Question Lock -->
        <div id="question-modal" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
            <div id="modal-content" class="bg-[#2c1a1a] border-2 border-[#d4c5a3] p-6 md:p-8 max-w-lg w-full rounded-sm shadow-2xl relative">
                <button onclick="closeModal()" class="absolute top-4 right-4 text-[#d4c5a3] hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>

                <div class="text-center mb-8 pt-4">
                    <h3 class="font-heading text-2xl text-[#d4c5a3] mb-4 border-b border-[#d4c5a3] pb-2 inline-block">SECURITY CHECK</h3>
                    <p id="modal-question" class="font-typewriter text-lg leading-relaxed text-[#e8e4d9]"></p>
                </div>

                <div id="modal-options" class="space-y-3">
                    <!-- Options injected via JS -->
                </div>

                <div id="modal-feedback" class="mt-6 text-center text-red-400 font-typewriter text-sm animate-pulse hidden"></div>
            </div>
        </div>
    </div>

    <!-- STORYBOARD VIEW -->
    <div id="storyboard-view" class="hidden">
        <!-- Global Texture Overlays -->
        <div class="fixed inset-0 pointer-events-none bg-grain z-50"></div>
        <div class="fixed inset-0 pointer-events-none z-40 bg-[radial-gradient(circle_at_center,transparent_0%,rgba(0,0,0,0.5)_100%)]"></div>

        <div class="storyboard-container animate-fade-in">
            <div class="story-content">
                <!-- Left: 30% full-height Video -->
                <div class="left-box">
                    <video id="storyVideo" class="video-fill" src="swetha.mp4" autoplay muted loop playsinline></video>
                </div>

                <!-- Right: 70% split vertically 60/40 -->
                <div class="right-box">
                    <div class="story-panel">
                        <div class="story-title">Initial Capital</div>
                        <div class="story-subtitle">REF: The Beginning</div>
                        <div id="storyBody" class="story-body story-text"></div>
                        <button id="continueBtn" style="display:none; margin-top:12px; align-self:flex-start; background:#2c1a1a; color:#d4c5a3; border:2px solid #4a3428; padding:10px 16px; font-family:'Courier Prime', monospace; font-weight:bold; letter-spacing:1px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.4);">CONTINUE</button>
                    </div>

                    <div class="question-box" id="storyQuestionBox" style="display:none;">
                        <div class="question-title">SECURITY CHECK</div>
                        <div class="question-divider"></div>
                        <div class="question-text" id="storyQuestionText"></div>
                        
                        <div class="options-container" id="storyOptionsContainer"></div>

                        <div id="storyFeedbackMessage" class="feedback-message"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const CASE_DATA = [
            {
                id: 1,
                title: "Initial Capital",
                subtitle: "Meet Swetha",
                lockedText: "The first investment was curiosity.",
                question: "What defined Swetha's beginning the most?",
                options: [
                    { id: 'A', text: "Confidence" },
                    { id: 'B', text: "Curiosity" },
                    { id: 'C', text: "Certainty" }
                ],
                correctAnswer: 'B',
                feedback: {
                    'A': "üòè Confidence? At the start?\nBold assumption. Wrong timeline.",
                    'B': "üòå Correct. Curiosity walked in quietly and carried the whole story.",
                    'C': "üò¨ Certainty this early?\nThat's how boring stories are born."
                },
                unlockMessage: "Curiosity compounds faster than comfort.",
                story: "Swetha didn't begin with confidence or certainty. She began with curiosity‚Äîchoosing learning over ease.",
                details: {
                    type: "Bio",
                    content: {
                        Name: "Swetha Guru",
                        Role: "Software Associate",
                        Location: "Coimbatore, Tamil Nadu, India",
                        Email: "swethaguru007@gmail.com",
                        LinkedIn: "linkedin.com/in/swethaguru-36a98b1bb"
                    }
                },
                inventoryIcon: "briefcase",
                inventoryName: "Curiosity Token",
                inventoryDesc: "The earliest form of capital."
            },
            {
                id: 2,
                title: "Foundations",
                subtitle: "A Curious Little Girl",
                lockedText: "Before skills, there were questions. Theory provides the map, but not the territory.",
                question: "What did Swetha really enjoy drawing?",
                options: [
                    { id: 'A', text: "Perfect shapes" },
                    { id: 'B', text: "Random doodles" },
                    { id: 'C', text: "Ideas" }
                ],
                correctAnswer: 'C',
                feedback: {
                    'A': "üìê Relax. This isn't a math textbook.",
                    'B': "‚úèÔ∏è Chaos, but with purpose. Almost.",
                    'C': "üß† Correct. Ideas don't stay inside lines."
                },
                unlockMessage: "Confusion is often the first sign of growth.",
                story: "Swetha learned by asking, doubting, and exploring. Education wasn't smooth‚Äîbut it was honest.",
                details: {
                    type: "Education",
                    content: {
                        Degree: "Bachelor's in Computer Science",
                        Institution: "SNS Institutions",
                        Duration: "June 2020 ‚Äì April 2024",
                        Note: "Graduated with questions, not just answers."
                    }
                },
                inventoryIcon: "graduation-cap",
                inventoryName: "Education Ledger",
                inventoryDesc: "Questions recorded before answers existed."
            },
            {
                id: 3,
                title: "Market Reality",
                subtitle: "Stepping Into the Real World",
                lockedText: "Theory meets production. The clean code of the classroom meets the chaos of the real world.",
                question: "What surprised Swetha most about real work?",
                options: [
                    { id: 'A', text: "Plans always change" },
                    { id: 'B', text: "Bugs appear magically" },
                    { id: 'C', text: "Mistakes teach more than books" }
                ],
                correctAnswer: 'C',
                feedback: {
                    'A': "üîÑ Plans change more than passwords.",
                    'B': "üêõ Bugs smell confidence. You'll learn.",
                    'C': "üòé Painful? Yes.\nEducational? Extremely."
                },
                unlockMessage: "Software is alive. It never truly ends.",
                story: "Work taught Swetha that systems grow, break, and improve continuously.",
                details: {
                    type: "Experience",
                    content: [
                        { role: "Software Associate", company: "SNS Square", loc: "Bangalore", time: "Sep 2025 ‚Äì Present" },
                        { role: "Junior Software Associate", company: "SNS iNNovation Hub", loc: "Coimbatore", time: "Aug 2024 ‚Äì Sep 2025" }
                    ]
                },
                inventoryIcon: "cpu",
                inventoryName: "Experience File",
                inventoryDesc: "Lessons learned under real pressure."
            },
            {
                id: 4,
                title: "Compounding",
                subtitle: "Skills Along the Way",
                lockedText: "No shortcuts. Only repetition. Value is built layer by layer.",
                question: "How did Swetha build her skills?",
                options: [
                    { id: 'A', text: "Getting everything right" },
                    { id: 'B', text: "Failing once and moving on" },
                    { id: 'C', text: "Trying, failing, fixing, repeating" }
                ],
                correctAnswer: 'C',
                feedback: {
                    'A': "ü§® That's not growth. That's fiction.",
                    'B': "üòÖ Growth needs commitment, not speed dating.",
                    'C': "üîÅ Congratulations. You understand reality."
                },
                unlockMessage: "Growth hurts. That's how you know it's working.",
                story: "Skills were built through failure, retrying, and patience.",
                details: {
                    type: "Skills",
                    content: ["Java", "Debugging & Troubleshooting", "Clean Code Practices", "Problem Solving", "AI & Automation Basics"]
                },
                inventoryIcon: "zap",
                inventoryName: "Skill Blueprint",
                inventoryDesc: "Built by iteration, not shortcuts."
            },
            {
                id: 5,
                title: "Reinvestment",
                subtitle: "Lessons Beyond Books",
                lockedText: "Why reinvest time? The market evolves, and static capital depreciates.",
                question: "Why did Swetha keep learning after work?",
                options: [
                    { id: 'A', text: "For certificates" },
                    { id: 'B', text: "Curiosity wouldn't sleep" },
                    { id: 'C', text: "To stay busy" }
                ],
                correctAnswer: 'B',
                feedback: {
                    'A': "üìú Nice decoration. Learning sold separately.",
                    'B': "üåô Correct. Curiosity has insomnia. Deal with it.",
                    'C': "üò¥ Busy isn't impressive. Learning is."
                },
                unlockMessage: "Knowledge compounds better than badges.",
                story: "Certifications were tools‚Äînot trophies.",
                details: {
                    type: "Certifications",
                    content: [
                        "Databricks Certified Generative AI Engineer ‚Äì Associate",
                        "IBM Enterprise Co-Creator",
                        "Courses: Generative AI, AI Agents, Java Essentials"
                    ]
                },
                inventoryIcon: "award",
                inventoryName: "Certification Seal",
                inventoryDesc: "Stamped proof of reinvestment."
            },
            {
                id: 6,
                title: "The Engineer",
                subtitle: "She Is Becoming",
                lockedText: "Becoming isn't a finish line; it's a direction.",
                question: "What choice defines Swetha today?",
                options: [
                    { id: 'A', text: "Speed over meaning" },
                    { id: 'B', text: "Perfection over progress" },
                    { id: 'C', text: "Understanding over shortcuts" }
                ],
                correctAnswer: 'C',
                feedback: {
                    'A': "‚ö° Fast and wrong is still wrong.",
                    'B': "üß© Perfection is just procrastination in a suit.",
                    'C': "üß† Correct. Mature choice. Engineer unlocked."
                },
                unlockMessage: "Curiosity over ego. Meaning over speed.",
                story: "Still curious. Still learning. Still asking questions.\n\nThis is me. This is my story.",
                details: {
                    type: "Outlook",
                    content: {
                        Focus: "Meaning over speed",
                        Principle: "Understanding over shortcuts",
                        Mindset: "Curiosity over ego"
                    }
                },
                inventoryIcon: "compass",
                inventoryName: "Becoming Compass",
                inventoryDesc: "Points toward growth, not perfection."
            }
        ];

        // Storyboard chapters
        const CHAPTERS = [
            {
                num: 0,
                title: "INITIAL CAPITAL",
                subtitle: "REF: THE BEGINNING",
                html: `<p>Once upon a time, not very far away, there lived a girl named Swetha.</p>
                       <p>She didn't arrive with loud announcements or grand speeches.</p>
                       <p>She arrived with a quiet curiosity, the kind that sits patiently and observes before asking questions.</p>
                       <p>Swetha always seemed to be thinking.</p>
                       <p>Not because she knew everything‚Äî<br/>but because she wanted to.</p>
                       <p>Some stories begin with confidence.</p>
                       <p>This one begins with curiosity‚Ä¶<br/>which, if we're honest, causes far more adventures.</p>`
            },
            {
                num: 1,
                title: "THE CURIOUS MIND",
                subtitle: "REF: EARLY DISCOVERIES",
                html: `<p>Long before code and screens, there was a little girl with a pencil.</p>
                       <p>Swetha loved to draw‚Äî<br/>not just shapes, but ideas.</p>
                       <p>She asked "why" often enough that adults learned to sigh creatively.</p>
                       <p>School taught her lessons,<br/>but curiosity taught her more.</p>
                       <p>While rules explained what to do,<br/>her questions explored what if.</p>
                       <p>And somewhere between notebooks, drawings, and wondering minds,<br/>a quiet thought began to form:</p>
                       <p>"I want to understand how things work."</p>
                       <p>Stories usually start exactly like this‚Äî<br/>softly, without anyone noticing.</p>`
            },
            {
                num: 2,
                title: "COLLISION WITH REALITY",
                subtitle: "REF: PROFESSIONAL ENTRY",
                html: `<p>Then one day, the real world knocked.</p>
                       <p>It didn't ask politely.</p>
                       <p>Work arrived with deadlines, meetings, and bugs that appeared without warning‚Äî<br/>especially when everything seemed fine five minutes ago.</p>
                       <p>Swetha learned quickly that<br/>real work doesn't follow textbooks,<br/>and plans often change their minds.</p>
                       <p>Mistakes became frequent visitors.<br/>Some stayed longer than welcome.</p>
                       <p>But instead of being afraid,<br/>Swetha listened.</p>
                       <p>Because every mistake had something to say‚Äî<br/>and she was finally fluent enough to hear it.</p>`
            },
            {
                num: 3,
                title: "THE CRAFT EMERGES",
                subtitle: "REF: SKILL DEVELOPMENT",
                html: `<p>Skills did not appear overnight.<br/>They arrived slowly‚Ä¶<br/>sometimes disguised as frustration.</p>
                       <p>Swetha tried.<br/>Failed.<br/>Fixed.<br/>Tried again.</p>
                       <p>She learned that understanding mattered more than speed,<br/>and patience mattered more than cleverness.</p>
                       <p>Some lessons came from practice.<br/>Others came from watching quietly.<br/>A few came from doing everything wrong once.</p>
                       <p>But each time, she picked up something new‚Äî<br/>not just skills,<br/>but confidence.</p>
                       <p>The story was no longer about getting things right.<br/>It was about getting better.</p>`
            },
            {
                num: 4,
                title: "CONTINUOUS LEARNING",
                subtitle: "REF: BEYOND THE BASICS",
                html: `<p>Even after long days,<br/>Swetha kept learning.</p>
                       <p>Not because she had to‚Äî<br/>but because curiosity refused to sleep.</p>
                       <p>She explored ideas beyond her work,<br/>collected lessons from courses,<br/>and discovered joy in understanding things more deeply.</p>
                       <p>Certificates appeared along the way‚Äî<br/>some shiny, some quiet.</p>
                       <p>But the real reward was clarity.<br/>Each new concept made the world feel a little less confusing.</p>
                       <p>Learning, she realized,<br/>was not a phase.<br/>It was a companion.</p>`
            },
            {
                num: 5,
                title: "THE ENGINEER REALIZED",
                subtitle: "REF: PRESENT MASTERY",
                html: `<p>Still curious.</p>
                      <p>Still learning.</p>
                      <p>Still asking questions.</p>
                      <p></p>
                      <p>This is me.</p>
                      <p>This is my story.</p>`
            },
            {
                num: 6,
                title: "THE ENGINEER SHE IS BECOMING",
                subtitle: "REF: THE NEXT CHAPTER",
                html: `<p>Still curious.</p>
                      <p>Still learning.</p>
                      <p>Still asking questions.</p>
                      <p></p>
                      <p>This is me.</p>
                      <p>This is my story.</p>`
            }
        ];

        // Storyboard questions
        const STORYBOARD_QUESTIONS = [
            {
                text: "What defined Swetha's beginning the most?",
                options: [
                    { id: 'A', text: 'Confidence' },
                    { id: 'B', text: 'Curiosity' },
                    { id: 'C', text: 'Certainty' }
                ],
                correct: 'B',
                feedback: {
                    'A': "üòè Confidence? At the start?\nBold assumption. Wrong timeline.",
                    'B': "üòå Correct. Curiosity walked in quietly and carried the whole story.",
                    'C': "üò¨ Certainty this early?\nThat's how boring stories are born."
                }
            },
            {
                text: "What did Swetha really enjoy drawing?",
                options: [
                    { id: 'A', text: 'Perfect shapes' },
                    { id: 'B', text: 'Random doodles' },
                    { id: 'C', text: 'Ideas' }
                ],
                correct: 'C',
                feedback: {
                    'A': "üìê Relax. This isn't a math textbook.",
                    'B': "‚úèÔ∏è Chaos, but with purpose. Almost.",
                    'C': "üß† Correct. Ideas don't stay inside lines."
                }
            },
            {
                text: "What surprised Swetha most about real work?",
                options: [
                    { id: 'A', text: 'Plans always change' },
                    { id: 'B', text: 'Bugs appear magically' },
                    { id: 'C', text: 'Mistakes teach more than books' }
                ],
                correct: 'C',
                feedback: {
                    'A': "üîÑ Plans change more than passwords.",
                    'B': "üêõ Bugs smell confidence. You'll learn.",
                    'C': "üòé Painful? Yes.\nEducational? Extremely."
                }
            },
            {
                text: "How did Swetha build her skills?",
                options: [
                    { id: 'A', text: 'Getting everything right' },
                    { id: 'B', text: 'Failing once and moving on' },
                    { id: 'C', text: 'Trying, failing, fixing, repeating' }
                ],
                correct: 'C',
                feedback: {
                    'A': "ü§® That's not growth. That's fiction.",
                    'B': "üòÖ Growth needs commitment, not speed dating.",
                    'C': "üîÅ Congratulations. You understand reality."
                }
            },
            {
                text: "Why did Swetha keep learning after work?",
                options: [
                    { id: 'A', text: 'For certificates' },
                    { id: 'B', text: 'Curiosity wouldn\'t sleep' },
                    { id: 'C', text: 'To stay busy' }
                ],
                correct: 'B',
                feedback: {
                    'A': "üìú Nice decoration. Learning sold separately.",
                    'B': "üåô Correct. Curiosity has insomnia. Deal with it.",
                    'C': "üò¥ Busy isn't impressive. Learning is."
                }
            },
            {
                text: "What choice defines Swetha today?",
                options: [
                    { id: 'A', text: 'Speed over meaning' },
                    { id: 'B', text: 'Perfection over progress' },
                    { id: 'C', text: 'Understanding over shortcuts' }
                ],
                correct: 'C',
                feedback: {
                    'A': "‚ö° Fast and wrong is still wrong.",
                    'B': "üß© Perfection is just procrastination in a suit.",
                    'C': "üß† Correct. Mature choice. Engineer unlocked."
                }
            }
        ];

        // --- STATE ---
        let currentChapter = 0;
        let isGameComplete = false;
        let inventory = [];
        let chapterState = { revealed: false };
        let viewMode = 'main';

        // --- DOM ELEMENTS ---
        const appContainer = document.getElementById('app-container');
        const inventoryList = document.getElementById('inventory-list');
        const modal = document.getElementById('question-modal');
        const modalContent = document.getElementById('modal-content');
        const modalQuestion = document.getElementById('modal-question');
        const modalOptions = document.getElementById('modal-options');
        const modalFeedback = document.getElementById('modal-feedback');
        const helpTooltip = document.getElementById('help-tooltip');
        const mainView = document.getElementById('main-view');
        const storyboardView = document.getElementById('storyboard-view');

        // Storyboard elements
        const storyBody = document.getElementById('storyBody');
        const storyTitle = document.querySelector('.story-title');
        const storySubtitle = document.querySelector('.story-subtitle');
        const storyPanel = document.querySelector('.story-panel');
        const continueBtn = document.getElementById('continueBtn');
        const storyQuestionBox = document.getElementById('storyQuestionBox');
        const storyQuestionText = document.getElementById('storyQuestionText');
        const storyOptionsContainer = document.getElementById('storyOptionsContainer');
        const storyFeedbackMessage = document.getElementById('storyFeedbackMessage');
        const storyVideo = document.getElementById('storyVideo');

        // --- INITIALIZATION ---
        function init() {
            const params = new URLSearchParams(window.location.search);
            const chapterParam = params.get('chapter');
            const revealedParam = params.get('revealed');
            const viewParam = params.get('view');
            
            if (chapterParam) {
                currentChapter = parseInt(chapterParam, 10);
                if (Number.isNaN(currentChapter)) currentChapter = 0;
                if (currentChapter < 0) currentChapter = 0;
                if (currentChapter >= CASE_DATA.length) currentChapter = CASE_DATA.length - 1;
            }
            
            if (revealedParam === 'true') {
                chapterState.revealed = true;
                const data = CASE_DATA[currentChapter];
                if (data && !inventory.includes(data.id)) {
                    inventory.push(data.id);
                }
            } else {
                chapterState.revealed = false;
            }

            // Pick starting view
            if (viewParam === 'storyboard') {
                setViewMode('storyboard');
                prepareStoryboard();
            } else {
                setViewMode('main');
                renderChapter();
                renderInventory();
            }

            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        // --- VIEW SWITCHING ---
        function setViewMode(mode) {
            viewMode = mode;
            if (mode === 'storyboard') {
                mainView.classList.add('hidden');
                storyboardView.classList.remove('hidden');
                document.body.classList.remove('mode-main');
                document.body.classList.add('mode-storyboard');
            } else {
                storyboardView.classList.add('hidden');
                mainView.classList.remove('hidden');
                document.body.classList.remove('mode-storyboard');
                document.body.classList.add('mode-main');
            }
        }

        function openStoryboard(chapterIndex = currentChapter) {
            currentChapter = clampChapter(chapterIndex);
            setViewMode('storyboard');
            prepareStoryboard();
            history.replaceState(null, '', `?chapter=${currentChapter}&view=storyboard`);
        }

        function returnToMain(revealed = false) {
            setViewMode('main');
            if (revealed) {
                chapterState.revealed = true;
                const data = CASE_DATA[currentChapter];
                if (data && !inventory.includes(data.id)) {
                    inventory.push(data.id);
                }
            }
            renderChapter();
            renderInventory();
            history.replaceState(null, '', `?chapter=${currentChapter}${revealed ? '&revealed=true' : ''}`);
            window.scrollTo(0, 0);
            lucide.createIcons();
        }

        function clampChapter(idx) {
            if (idx < 0) return 0;
            if (idx >= CASE_DATA.length) return CASE_DATA.length - 1;
            return idx;
        }

        // --- MAIN RENDER FUNCTIONS ---
        function renderChapter() {
            appContainer.innerHTML = '';

            if (isGameComplete) {
                appContainer.innerHTML = getFinalScreenHTML();
                lucide.createIcons();
                return;
            }

            const data = CASE_DATA[currentChapter];
            if (!data) {
                console.error('Invalid chapter:', currentChapter);
                currentChapter = 0;
                chapterState.revealed = false;
                return renderChapter();
            }
            
            let html = `
                <!-- Progress Indicator -->
                <div class="mb-8 font-typewriter text-xs tracking-[0.3em] opacity-50 text-center">
                    CASE FILE ${currentChapter + 1} OF ${CASE_DATA.length}
                </div>

                <!-- Folder Wrapper -->
                <div class="relative w-full max-w-3xl perspective-1000">
                    <div class="absolute -top-6 left-0 w-48 h-8 bg-[#c2b280] rounded-t-lg z-0 border-t border-l border-r border-black/20"></div>
                    
                    <div class="relative bg-[#e8e4d9] text-[#2c1a1a] p-6 md:p-12 rounded-lg paper-shadow min-h-[60vh] transition-all duration-700" id="case-folder">
                        
                        <!-- Stamp -->
                        <div class="absolute top-8 right-8 w-24 h-24 border-4 border-red-900/30 rounded-full flex items-center justify-center transform rotate-12 pointer-events-none hidden md:flex">
                            <span class="text-red-900/30 font-heading font-bold text-xs uppercase text-center leading-tight">CONFIDENTIAL<br/>PROPERTY OF<br/>SWETHA GURU</span>
                        </div>

                        <!-- Header -->
                        <div class="border-b-2 border-[#2c1a1a] pb-6 mb-8">
                            <h1 class="font-heading text-3xl md:text-5xl uppercase tracking-tighter mb-2 break-words">${data.title}</h1>
                            <p class="font-typewriter text-xs md:text-sm uppercase tracking-widest opacity-70">REF: ${data.subtitle}</p>
                        </div>

                        <!-- Content Area -->
                        <div id="chapter-content">
                            ${!chapterState.revealed ? getLockedContentHTML(data) : getRevealedContentHTML(data)}
                        </div>
                    </div>
                </div>

                ${chapterState.revealed ? `
                    <div class="mt-8 animate-bounce cursor-pointer pb-20 md:pb-0" onclick="nextChapter()">
                        <div class="flex flex-col items-center gap-2 text-[#d4c5a3] opacity-80 hover:opacity-100 transition-opacity">
                            <span class="font-typewriter text-xs uppercase tracking-widest bg-black/50 px-2 rounded">
                                ${currentChapter < CASE_DATA.length - 1 ? "Next Case File" : "Close Investigation"}
                            </span>
                            <i data-lucide="chevron-down" class="w-6 h-6"></i>
                        </div>
                    </div>
                ` : ''}
            `;

            appContainer.innerHTML = html;
            lucide.createIcons();

            if (chapterState.revealed) {
                const storyEl = document.getElementById('typewriter-story');
                if (storyEl) typeWriter(storyEl, data.story);
            }
        }

        function getLockedContentHTML(data) {
            return `
                <div class="relative">
                    <div class="blur-text font-typewriter text-lg leading-relaxed mb-8">
                        ${data.story}
                        <br/><br/>
                        [REDACTED DATA SECTION]
                        <br/>
                        [ASSET VALUATION PENDING]
                    </div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center z-10">
                        <p class="font-heading text-xl md:text-2xl mb-8 text-center max-w-md animate-flicker px-4">"${data.lockedText}"</p>
                        <button type="button" onclick="openStoryboard(${currentChapter})" class="bg-[#2c1a1a] text-[#d4c5a3] px-8 py-3 rounded-sm font-heading text-xl hover:scale-105 transition-transform flex items-center gap-3 shadow-xl active:scale-95 no-underline">
                            <i data-lucide="lock" class="w-5 h-5"></i> DECRYPT FILE
                        </button>
                    </div>
                </div>
            `;
        }

        function getRevealedContentHTML(data) {
            return `
                <div class="animate-slide-up">
                    <div class="flex items-center gap-3 text-emerald-700 mb-6 font-typewriter text-sm font-bold bg-emerald-100/50 p-2 inline-block rounded">
                        <i data-lucide="unlock" class="w-4 h-4"></i> ACCESS GRANTED
                    </div>
                    
                    <div class="font-serif text-lg md:text-xl leading-relaxed mb-8 border-l-4 border-[#2c1a1a] pl-6 italic">
                        <span id="typewriter-story" style="white-space: pre-line"></span>
                    </div>

                    <div class="bg-[#fff] p-6 shadow-md transform -rotate-1 relative max-w-md mx-auto border border-gray-200">
                        <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-8 h-12 border-4 border-gray-400 rounded-full border-b-0"></div>
                        <h3 class="font-heading text-xl border-b border-gray-300 pb-2 mb-4 uppercase">
                            ${data.details.type} Record
                        </h3>
                        ${renderDetailsHTML(data.details)}
                    </div>
                </div>
            `;
        }

        function renderDetailsHTML(details) {
            if (Array.isArray(details.content)) {
                if (details.type === "Experience") {
                    return `
                        <div class="space-y-4">
                            ${details.content.map(job => `
                                <div class="border-l-2 border-[#2c1a1a] pl-4">
                                    <div class="font-bold text-lg">${job.role}</div>
                                    <div class="font-typewriter text-sm">${job.company} | ${job.loc}</div>
                                    <div class="text-xs italic opacity-75">${job.time}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                return `
                    <ul class="list-disc pl-5 font-handwriting text-xl space-y-1">
                        ${details.content.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                `;
            }
            return `
                <div class="grid grid-cols-1 gap-2 font-typewriter text-sm break-words">
                    ${Object.entries(details.content).map(([key, value]) => `
                        <div>
                            <span class="font-bold uppercase opacity-60">${key}:</span> <span class="text-[#2c1a1a]">${value}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getFinalScreenHTML() {
            return `
                <div class="max-w-2xl w-full bg-[#e8e4d9] text-[#2c1a1a] p-8 md:p-12 rounded-sm paper-shadow transform rotate-1 relative animate-fade-in">
                    <div class="absolute top-4 right-4 border-4 border-red-800 rounded-full w-24 h-24 flex items-center justify-center transform -rotate-12 opacity-80">
                        <span class="text-red-800 font-heading font-bold text-lg">OPEN CASE</span>
                    </div>
                    
                    <h2 class="font-heading text-4xl mb-6 border-b-2 border-[#2c1a1a] pb-4">INVESTIGATION SUMMARY</h2>
                    
                    <div class="font-typewriter text-left space-y-4 mb-8">
                        <p><strong>SUBJECT:</strong> Swetha Guru</p>
                        <p><strong>STATUS:</strong> Compounding Growth Confirmed</p>
                        <p><strong>STRATEGY:</strong> Continuous Learning & Reinvestment</p>
                        <div class="h-px bg-[#2c1a1a] w-full my-4 opacity-30"></div>
                        <p class="text-lg">
                            "Swetha isn't rushing outcomes. She's building value. 
                            Unlike static code, her portfolio evolves with every challenge."
                        </p>
                    </div>

                    <div class="flex flex-wrap gap-4 justify-center">
                        <button onclick="resetGame()" class="px-6 py-3 bg-[#2c1a1a] text-[#d4c5a3] font-heading text-xl hover:bg-[#3d2424] transition-colors shadow-lg">
                            REOPEN CASE FILE
                        </button>
                        <a href="mailto:swethaguru007@gmail.com" class="px-6 py-3 border-2 border-[#2c1a1a] text-[#2c1a1a] font-heading text-xl hover:bg-[#2c1a1a] hover:text-[#d4c5a3] transition-colors">
                            CONTACT SUBJECT
                        </a>
                    </div>
                </div>
            `;
        }

        function renderInventory() {
            inventoryList.innerHTML = CASE_DATA.map(chapter => {
                const isUnlocked = inventory.includes(chapter.id);
                return `
                    <div class="group relative flex-shrink-0 w-12 h-12 mb-0 md:mb-4 border-2 rounded flex items-center justify-center transition-all duration-300 cursor-help ${isUnlocked ? 'border-[#d4c5a3] bg-[#2c1a1a] text-[#d4c5a3] shadow-[0_0_10px_rgba(212,197,163,0.3)]' : 'border-stone-700 bg-stone-900 text-stone-700'}">
                        <i data-lucide="${isUnlocked ? chapter.inventoryIcon : 'lock'}" class="w-4 h-4"></i>
                        <div class="absolute bottom-full md:bottom-auto md:right-14 md:top-0 w-48 p-3 bg-stone-900 border border-[#d4c5a3] text-[#d4c5a3] text-xs font-typewriter rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 mb-2 md:mb-0">
                            <strong class="block mb-1 text-emerald-400">${isUnlocked ? chapter.inventoryName : "Unknown Item"}</strong>
                            ${isUnlocked ? chapter.inventoryDesc : "Unlock chapter to acquire."}
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        // --- ACTIONS ---
        function toggleHelp() { helpTooltip.classList.toggle('hidden'); }

        function skipCase() { isGameComplete = true; renderChapter(); }

        function nextChapter() {
            if (currentChapter < CASE_DATA.length - 1) {
                currentChapter++;
                chapterState.revealed = false;
                renderChapter();
                window.scrollTo(0, 0);
            } else {
                isGameComplete = true;
                renderChapter();
            }
        }

        function resetGame() {
            currentChapter = 0;
            isGameComplete = false;
            inventory = [];
            chapterState.revealed = false;
            renderChapter();
            renderInventory();
            history.replaceState(null, '', '?chapter=0');
        }

        // --- MODAL LOGIC (MAIN) ---
        function openQuestionModal() {
            const data = CASE_DATA[currentChapter];
            modalQuestion.textContent = data.question;
            modalFeedback.classList.add('hidden');
            
            modalOptions.innerHTML = data.options.map(opt => `
                <button onclick="handleUnlockAttempt('${opt.id}')" class="w-full text-left p-4 border border-[#5c3a3a] bg-[#1a0f0f] text-[#d4c5a3] font-typewriter hover:bg-[#3d2424] hover:border-[#d4c5a3] transition-all flex items-center gap-4 group active:bg-[#d4c5a3] active:text-[#1a0f0f]">
                    <span class="w-8 h-8 rounded-full border border-[#5c3a3a] flex items-center justify-center text-xs group-hover:border-[#d4c5a3] group-hover:bg-[#d4c5a3] group-hover:text-[#1a0f0f] shrink-0">
                        ${opt.id}
                    </span>
                    ${opt.text}
                </button>
            `).join('');
            
            modal.classList.remove('hidden');
        }

        function closeModal() { modal.classList.add('hidden'); }

        function handleUnlockAttempt(optionId) {
            const data = CASE_DATA[currentChapter];
            const feedbackMessage = data.feedback ? data.feedback[optionId] : (optionId === data.correctAnswer ? data.unlockMessage : data.wrongFeedback);
            
            if (optionId === data.correctAnswer) {
                modalFeedback.textContent = feedbackMessage;
                modalFeedback.classList.remove('hidden');
                modalFeedback.classList.add('text-emerald-400');
                modalFeedback.classList.remove('text-red-400');
                
                setTimeout(() => {
                    closeModal();
                    chapterState.revealed = true;
                    if (!inventory.includes(data.id)) {
                        inventory.push(data.id);
                        renderInventory();
                    }
                    renderChapter();
                }, 1500);
            } else {
                modalFeedback.textContent = feedbackMessage;
                modalFeedback.classList.remove('hidden');
                modalFeedback.classList.add('text-red-400');
                modalFeedback.classList.remove('text-emerald-400');
                modalContent.classList.add('animate-shake');
                setTimeout(() => { modalContent.classList.remove('animate-shake'); }, 500);
            }
        }

        // --- TYPEWRITER UTILITY ---
        function typeWriter(element, text, speed = 30) {
            let i = 0;
            element.textContent = '';
            function type() {
                if (i < text.length) {
                    element.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        // --- STORYBOARD HELPERS ---
        function typeWriterHTML(el, html, speed = 30, onComplete) {
            let i = 0;
            el.innerHTML = '';

            function type() {
                if (i >= html.length) {
                    if (typeof onComplete === 'function') onComplete();
                    return;
                }

                if (html[i] === '<') {
                    const closeIdx = html.indexOf('>', i);
                    if (closeIdx !== -1) {
                        el.innerHTML += html.slice(i, closeIdx + 1);
                        i = closeIdx + 1;
                        requestAnimationFrame(type);
                        return;
                    }
                }

                el.innerHTML += html[i];
                i++;
                setTimeout(type, speed);
            }

            type();
        }

        function prepareStoryboard() {
            const chapterNum = clampChapter(currentChapter);
            const storyData = CHAPTERS.find(c => c.num === chapterNum) || CHAPTERS[0];
            const questionData = STORYBOARD_QUESTIONS[Math.min(Math.max(chapterNum, 0), STORYBOARD_QUESTIONS.length - 1)];

            if (storyTitle) storyTitle.textContent = storyData.title;
            if (storySubtitle) storySubtitle.textContent = storyData.subtitle;
            if (storyQuestionBox) storyQuestionBox.style.display = 'none';
            if (continueBtn) continueBtn.style.display = 'none';
            if (storyPanel) {
                storyPanel.style.display = 'flex';
                storyPanel.classList.remove('animate-fade-out');
            }
            if (storyFeedbackMessage) {
                storyFeedbackMessage.style.display = 'none';
                storyFeedbackMessage.textContent = '';
            }
            if (storyOptionsContainer) {
                storyOptionsContainer.style.opacity = '1';
                storyOptionsContainer.style.pointerEvents = 'auto';
            }

            if (storyVideo) {
                const playAttempt = storyVideo.play();
                if (playAttempt && typeof playAttempt.then === 'function') {
                    playAttempt.catch(() => {});
                }
            }

            if (storyBody) {
                typeWriterHTML(storyBody, storyData.html, 25, () => {
                    if (continueBtn) continueBtn.style.display = 'inline-flex';
                    if (storyVideo) {
                        storyVideo.pause();
                        storyVideo.currentTime = 0;
                    }
                });
            }

            if (continueBtn && storyQuestionBox && storyPanel) {
                continueBtn.onclick = () => {
                    continueBtn.style.display = 'none';
                    storyPanel.classList.add('animate-fade-out');
                    
                    // Use both animationend and timeout as fallback
                    let transitionDone = false;
                    const completeTransition = () => {
                        if (transitionDone) return;
                        transitionDone = true;
                        storyPanel.style.display = 'none';
                        storyPanel.classList.remove('animate-fade-out');
                        storyQuestionBox.style.display = 'flex';
                        storyQuestionBox.classList.remove('animate-fade-in');
                        storyQuestionBox.classList.add('animate-fade-in');
                        populateStoryboardQuestion(questionData, chapterNum);
                    };
                    
                    storyPanel.addEventListener('animationend', completeTransition, { once: true });
                    setTimeout(completeTransition, 500); // Fallback after 500ms
                };
            }
        }

        function populateStoryboardQuestion(questionData, chapterNum) {
            if (!questionData) return;
            if (storyQuestionText) storyQuestionText.textContent = questionData.text;
            if (storyOptionsContainer) {
                storyOptionsContainer.innerHTML = questionData.options.map(opt => `
                    <button class="option-btn" onclick="selectStoryboardOption('${opt.id}', ${chapterNum})">
                        <span class="option-letter">${opt.id}</span>
                        <span>${opt.text}</span>
                    </button>
                `).join('');
            }
        }

        function selectStoryboardOption(optionId, chapterNum) {
            const question = STORYBOARD_QUESTIONS[Math.min(Math.max(chapterNum, 0), STORYBOARD_QUESTIONS.length - 1)];
            const correctAnswer = question.correct;
            const feedbackMessage = question.feedback ? question.feedback[optionId] : (optionId === correctAnswer ? '‚úì CORRECT - Access Granted!' : '‚úó INCORRECT - Try Again');

            if (optionId === correctAnswer) {
                storyFeedbackMessage.textContent = feedbackMessage;
                storyFeedbackMessage.className = 'feedback-message feedback-correct';
                storyFeedbackMessage.style.display = 'block';
                storyOptionsContainer.style.opacity = '0.5';
                storyOptionsContainer.style.pointerEvents = 'none';
                
                setTimeout(() => {
                    returnToMain(true);
                }, 2000);
            } else {
                storyFeedbackMessage.textContent = feedbackMessage;
                storyFeedbackMessage.className = 'feedback-message feedback-incorrect';
                storyFeedbackMessage.style.display = 'block';
                
                setTimeout(() => {
                    storyFeedbackMessage.style.display = 'none';
                }, 2000);
            }
        }

        // --- START ---
        init();
    </script>
</body>
</html>
